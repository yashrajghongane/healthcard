<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emergency QR Mode | HealthCard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode" defer></script>
  </head>
  <body class="bg-slate-950 text-slate-100 min-h-screen overflow-y-auto">
    <div class="fixed top-0 -left-40 h-[500px] w-[500px] rounded-full bg-red-500/10 blur-[100px] pointer-events-none -z-10"></div>

    <header class="border-b border-white/10 bg-slate-950/85 backdrop-blur sticky top-0 z-20">
      <div class="mx-auto flex max-w-5xl items-center justify-between px-5 py-4">
        <div class="flex items-center gap-3">
          <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-red-500 text-white font-bold">ER</div>
          <div>
            <p class="text-lg font-semibold tracking-tight">Emergency QR Mode</p>
            <p class="text-xs text-red-300">Immediate patient snapshot</p>
          </div>
        </div>
        <a href="./index.html" class="rounded-full border border-white/20 px-4 py-2 text-sm text-slate-200 hover:border-white/40 transition">Back</a>
      </div>
    </header>

    <main class="mx-auto w-full max-w-5xl px-5 py-6">
      <div class="mb-6 rounded-2xl border border-red-500/30 bg-red-500/10 p-4 text-sm text-red-100">
        Emergency access: scan patient QR or enter Card ID to view critical profile and visit history.
      </div>

      <form id="emergencySearchForm" class="flex flex-col sm:flex-row gap-3 mb-6">
        <input id="emergencySearchInput" type="text" placeholder="Scan or enter Card ID / QR ID" class="w-full rounded-xl border border-white/10 bg-slate-900/80 px-4 py-3 text-white placeholder:text-slate-500 focus:border-red-400 focus:outline-none focus:ring-1 focus:ring-red-400 transition" />
        <button type="submit" class="rounded-xl bg-red-500 px-5 py-3 text-sm font-bold text-white hover:bg-red-400 transition">Fetch Emergency Data</button>
        <button id="openEmergencyScannerBtn" type="button" class="rounded-xl border border-white/20 bg-white/5 px-5 py-3 text-sm font-semibold text-slate-200 hover:bg-white/10 transition">Scan QR</button>
      </form>

      <div id="emergencyError" class="hidden mb-6 rounded-xl border border-red-500/40 bg-red-500/10 p-4 text-red-200 text-sm"></div>

      <section id="emergencyResult" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6">
        <div class="lg:col-span-5 rounded-3xl border border-white/10 bg-slate-900/50 p-6">
          <h2 class="text-xl font-semibold text-white mb-4">Patient Info</h2>
          <div class="space-y-3 text-sm">
            <p><span class="text-slate-400">Name:</span> <span id="emergencyName" class="text-white font-medium">--</span></p>
            <p><span class="text-slate-400">Card ID:</span> <span id="emergencyCardId" class="text-emerald-300 font-mono">--</span></p>
            <p><span class="text-slate-400">QR ID:</span> <span id="emergencyQrId" class="text-emerald-300 font-mono">--</span></p>
            <p><span class="text-slate-400">Blood Group:</span> <span id="emergencyBlood" class="text-red-300 font-semibold">--</span></p>
            <p><span class="text-slate-400">DOB:</span> <span id="emergencyDob" class="text-white">--</span></p>
            <p><span class="text-slate-400">Phone:</span> <span id="emergencyPhone" class="text-white">--</span></p>
            <p><span class="text-slate-400">Relative Phone:</span> <span id="emergencyRelativePhone" class="text-white">--</span></p>
            <p><span class="text-slate-400">Allergies:</span> <span id="emergencyAllergies" class="text-amber-300">--</span></p>
          </div>
        </div>

        <div class="lg:col-span-7 rounded-3xl border border-white/10 bg-slate-900/50 p-6">
          <h2 class="text-xl font-semibold text-white mb-4">Recent Medical History</h2>
          <div id="emergencyTimeline" class="relative border-l border-slate-700 ml-3 space-y-6"></div>
        </div>
      </section>
    </main>

    <div id="emergencyScannerModal" class="fixed inset-0 z-50 hidden items-end sm:items-center justify-center bg-slate-950/85 px-0 sm:px-4">
      <div class="w-full sm:max-w-lg rounded-t-3xl sm:rounded-3xl border border-white/10 bg-slate-900 p-5 sm:p-6">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h3 class="text-lg font-semibold text-white">Scan Emergency QR</h3>
            <p class="text-sm text-slate-400 mt-1">Align patient QR in frame.</p>
          </div>
          <button type="button" id="closeEmergencyScannerModal" class="rounded-lg border border-white/20 px-3 py-1.5 text-sm text-slate-200 hover:border-white/40 transition">Close</button>
        </div>

        <div class="mt-4 rounded-2xl border border-white/10 bg-slate-950/60 p-3">
          <div id="emergencyScannerReader" class="w-full overflow-hidden rounded-xl"></div>
        </div>

        <p id="emergencyScannerStatus" class="mt-3 text-xs text-slate-400">Initializing camera...</p>
      </div>
    </div>

    <script src="./assets/js/emergency.js"></script>
  </body>
</html>
