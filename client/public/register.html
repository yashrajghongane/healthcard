<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register | HealthCard</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-950 text-slate-100 min-h-screen overflow-y-auto">
    <header class="p-6">
      <div class="mx-auto flex max-w-7xl items-center justify-between">
        <a href="index.html" class="flex items-center gap-3 hover:opacity-80 transition">
          <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-500 text-slate-950 font-bold">HC</div>
          <span class="text-lg font-semibold tracking-tight">HealthCard</span>
        </a>
        <a href="index.html" class="text-sm text-slate-400 hover:text-emerald-400 transition flex items-center gap-2">
          <span>Already have an account?</span>
          <span class="rounded-full border border-white/20 px-4 py-2 text-slate-200 hover:border-emerald-400 hover:text-white transition">Login</span>
        </a>
      </div>
    </header>

    <main class="flex items-center justify-center p-6 py-12">
      <div class="w-full max-w-md rounded-3xl border border-white/10 bg-slate-900 p-8 shadow-2xl">
        <div class="text-center space-y-2 mb-8">
          <h1 class="text-3xl font-semibold text-white">Create Account</h1>
        </div>

        <form id="registerForm" class="space-y-5">
          
          <div>
            <label class="text-sm font-medium text-slate-300">I am registering as a...</label>
            <div class="mt-3 grid grid-cols-2 gap-3">
              <label class="flex cursor-pointer items-center justify-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 transition peer-checked:border-emerald-400 relative">
                <input type="radio" name="role" value="patient" class="peer hidden" checked onchange="toggleRoleFields()" />
                <div class="absolute inset-0 rounded-xl border-2 border-transparent peer-checked:border-emerald-400 transition-all"></div>
                <span class="relative z-10 peer-checked:text-emerald-400">Patient</span>
              </label>
              
              <label class="flex cursor-pointer items-center justify-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 transition relative">
                <input type="radio" name="role" value="doctor" class="peer hidden" onchange="toggleRoleFields()" />
                <div class="absolute inset-0 rounded-xl border-2 border-transparent peer-checked:border-emerald-400 transition-all"></div>
                <span class="relative z-10 peer-checked:text-emerald-400">Doctor</span>
              </label>
            </div>
          </div>

          <div>
            <label class="text-sm font-medium text-slate-300" for="fullname">Full Name</label>
            <input id="fullname" type="text" placeholder="e.g. Aarav Sharma" required class="mt-2 w-full rounded-xl border border-white/10 bg-slate-950/60 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none focus:ring-1 focus:ring-emerald-400 transition" />
          </div>

          <div>
            <label class="text-sm font-medium text-slate-300" for="email">Email Address</label>
            <input id="email" type="email" placeholder="you@example.com" required class="mt-2 w-full rounded-xl border border-white/10 bg-slate-950/60 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none focus:ring-1 focus:ring-emerald-400 transition" />
          </div>

          <div id="doctorFields" class="hidden animate-in fade-in slide-in-from-top-2 duration-300">
            <label class="text-sm font-medium text-slate-300" for="license">Medical License Number</label>
            <input id="license" type="text" placeholder="e.g. MED-847291" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-950/60 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none focus:ring-1 focus:ring-emerald-400 transition" />
            <p class="text-xs text-slate-500 mt-2">Required for doctor verification.</p>
          </div>

          <div>
            <label class="text-sm font-medium text-slate-300" for="password">Password</label>
            <input id="password" type="password" placeholder="Create a strong password" required class="mt-2 w-full rounded-xl border border-white/10 bg-slate-950/60 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none focus:ring-1 focus:ring-emerald-400 transition" />
          </div>

          <button type="submit" id="submitBtn" class="w-full rounded-xl bg-emerald-400 px-4 py-3.5 text-sm font-bold text-slate-950 hover:bg-emerald-300 transition mt-6">
            Register
          </button>
        </form>
      </div>
    </main>

    <script src="./assets/js/api.js"></script>
    <script src="./assets/js/auth.js"></script>
    <script>
      // Logic to toggle role-specific fields
      function toggleRoleFields() {
        const role = document.querySelector('input[name="role"]:checked').value;
        const doctorFields = document.getElementById('doctorFields');
        const submitBtn = document.getElementById('submitBtn');
        const licenseInput = document.getElementById('license');

        if (role === 'doctor') {
          doctorFields.classList.remove('hidden');
          licenseInput.setAttribute('required', 'true');
          submitBtn.innerText = 'Register as Doctor';
        } else {
          doctorFields.classList.add('hidden');
          licenseInput.removeAttribute('required');
          submitBtn.innerText = 'Register';
        }
      }

      // Handle form submission
      document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const role = document.querySelector('input[name="role"]:checked').value;
        const fullname = document.getElementById('fullname').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();
        const license = document.getElementById('license').value.trim();

        // Validate inputs
        if (!fullname || !email || !password) {
          alert('Please fill in all required fields.');
          return;
        }

        if (role === 'doctor' && !license) {
          alert('Medical License Number is required for doctors.');
          return;
        }

        // Prepare user data
        const userData = {
          fullname,
          email,
          password,
          role
        };

        if (role === 'doctor') {
          userData.license = license;
        }

        // Register user
        const result = registerUser(userData);

        if (result.success) {
          alert('Registration successful! Redirecting to login...');
          window.location.href = 'index.html';
        } else {
          alert('Registration failed: ' + result.message);
        }
      });
    </script>
  </body>
</html>