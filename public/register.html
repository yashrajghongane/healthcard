<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Create your HealthCard account to securely manage and share patient medical identity and records." />
    <meta name="keywords" content="HealthCard registration, patient signup, doctor signup, digital health account" />
    <meta name="robots" content="index, follow" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="HealthCard" />
    <meta property="og:title" content="Register | HealthCard" />
    <meta property="og:description" content="Join HealthCard as a patient or doctor for secure digital health identity and record access." />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Register | HealthCard" />
    <meta name="twitter:description" content="Create your secure HealthCard account in minutes." />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <link rel="shortcut icon" href="./favicon.svg" />
    <title>Register | HealthCard</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-950 text-slate-100 min-h-screen overflow-y-auto">
    <header class="p-6">
      <div class="mx-auto flex max-w-7xl items-center justify-between">
        <a href="index.html" class="flex items-center gap-3 hover:opacity-80 transition">
          <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-500 text-slate-950 font-bold">HC</div>
          <span class="text-lg font-semibold tracking-tight">HealthCard</span>
        </a>
        <a href="index.html" class="text-sm text-slate-400 hover:text-emerald-400 transition flex items-center gap-2">
          <span>Already have an account?</span>
          <span class="rounded-full border border-white/20 px-4 py-2 text-slate-200 hover:border-emerald-400 hover:text-white transition">Login</span>
        </a>
      </div>
    </header>

    <main class="flex items-center justify-center p-6 py-12">
      <div class="w-full max-w-md rounded-3xl border border-white/10 bg-slate-900 p-8 shadow-2xl">
        <div class="text-center space-y-2 mb-8">
          <h1 class="text-3xl font-semibold text-white">Create Account</h1>
        </div>

        <form id="registerForm" class="space-y-5">
          
          <div>
            <label class="text-sm font-medium text-slate-300">I am registering as a...</label>
            <div class="mt-3 grid grid-cols-2 gap-3">
              <label class="flex cursor-pointer items-center justify-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 transition peer-checked:border-emerald-400 relative">
                <input type="radio" name="role" value="patient" class="peer hidden" checked onchange="toggleRoleFields()" />
                <div class="absolute inset-0 rounded-xl border-2 border-transparent peer-checked:border-emerald-400 transition-all"></div>
                <span class="relative z-10 peer-checked:text-emerald-400">Patient</span>
              </label>
              
              <label class="flex cursor-pointer items-center justify-center gap-2 rounded-xl border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 transition relative">
                <input type="radio" name="role" value="doctor" class="peer hidden" onchange="toggleRoleFields()" />
                <div class="absolute inset-0 rounded-xl border-2 border-transparent peer-checked:border-emerald-400 transition-all"></div>
                <span class="relative z-10 peer-checked:text-emerald-400">Doctor</span>
              </label>
            </div>
          </div>

          <div>
            <label class="text-sm font-medium text-slate-300" for="fullname">Full Name</label>
            <input id="fullname" type="text" placeholder="e.g. Aarav Sharma" required minlength="2" maxlength="80" pattern="[A-Za-z ]{2,80}" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-950/60 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none focus:ring-1 focus:ring-emerald-400 transition" />
          </div>

          <div>
            <label class="text-sm font-medium text-slate-300" for="email">Email Address</label>
            <input id="email" type="email" inputmode="email" autocomplete="email" placeholder="you@example.com" required pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$" class="mt-2 w-full rounded-xl border border-white/10 bg-slate-950/60 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none focus:ring-1 focus:ring-emerald-400 transition" />
          </div>

          <div>
            <label class="text-sm font-medium text-slate-300" for="password">Password</label>
            <input id="password" type="password" autocomplete="new-password" minlength="6" maxlength="72" placeholder="Create a strong password" required class="mt-2 w-full rounded-xl border border-white/10 bg-slate-950/60 px-4 py-3 text-sm text-white placeholder:text-slate-600 focus:border-emerald-400 focus:outline-none focus:ring-1 focus:ring-emerald-400 transition" />
          </div>

          <button type="submit" id="submitBtn" class="w-full rounded-xl bg-emerald-400 px-4 py-3.5 text-sm font-bold text-slate-950 hover:bg-emerald-300 transition mt-6">
            Register
          </button>
          <p id="registerStatus" class="hidden rounded-lg border px-3 py-2 text-xs"></p>
        </form>
      </div>
    </main>

    <script src="./assets/js/api.js?v=20260221b"></script>
    <script>
      window.__HC_USE_BACKEND_AUTH__ = true;
      window.__HC_API_BASE_URL__ = 'http://localhost:5000';
    </script>
    <script src="./assets/js/auth.js?v=20260221b"></script>
    <script>
      const registerStatus = document.getElementById('registerStatus');

      function setRegisterStatus(message, isError = false) {
        if (!registerStatus) return;
        registerStatus.classList.remove('hidden');
        registerStatus.className = `rounded-lg border px-3 py-2 text-xs ${isError ? 'border-red-400/40 bg-red-500/10 text-red-100' : 'border-emerald-400/30 bg-emerald-500/10 text-emerald-100'}`;
        registerStatus.textContent = message;
      }

      // Logic to toggle role-specific fields
      function toggleRoleFields() {
        const role = document.querySelector('input[name="role"]:checked').value;
        const submitBtn = document.getElementById('submitBtn');

        if (role === 'doctor') {
          submitBtn.innerText = 'Register as Doctor';
        } else {
          submitBtn.innerText = 'Register';
        }
      }

      // Handle form submission
      document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        if (!this.reportValidity()) {
          return;
        }
        
        const role = document.querySelector('input[name="role"]:checked').value;
        const fullname = document.getElementById('fullname').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (registerStatus) {
          registerStatus.classList.add('hidden');
        }

        // Validate inputs
        if (!fullname || !email || !password) {
          setRegisterStatus('Please fill in all required fields.', true);
          return;
        }

        // Prepare user data
        const userData = {
          fullname,
          email,
          password,
          role
        };

        // Register user
        const result = await registerAccount(userData);

        if (result.success) {
          setRegisterStatus('Registration successful! Redirecting to login...');
          setTimeout(() => {
            window.location.href = 'index.html';
          }, 900);
        } else {
          setRegisterStatus('Registration failed: ' + result.message, true);
        }
      });
    </script>
  </body>
</html>